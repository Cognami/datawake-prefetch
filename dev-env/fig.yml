mysql:
  image: mysql
  environment:
    MYSQL_ROOT_PASSWORD: root
  ports:
    - "3336:3306"
  volumes:
    - /home/ubuntu/trail-selections/dev-env:/dev-env

zookeeper:
  image: jplock/zookeeper
  ports:
    - "2181:2181"

kafka:
  image: wurstmeister/kafka:0.8.1.1-1
  ports:
    - "9092:9092"
  links:
    - zookeeper:zk
  environment:
    KAFKA_ADVERTISED_HOST_NAME: 172.31.31.203
    KAFKA_MESSAGE_MAX_BYTES: 2000000
    KAFKA_REPLICA_FETCH_MAX_BYTES: 3000000
  volumes:
    - /var/run/docker.sock:/var/run/docker.sock

dwsearch:
  build: ../trail-specific-search
  working_dir: /trail-specific-search
  links:
    - mysql:mysql
    - kafka:kafka
    - zookeeper:zk
  environment:
    DW_DB_USER: root
    DW_DB_PASSWORD: root
    DW_DB_JDBC: jdbc:mysql://172.31.31.203:3336/memex_sotera
    DW_CRAWLER_TOPIC: memex.crawled_trail-entities-search
    DW_BING_KEY: AeLgwrJ49hIsdsivwmnGs6VOHq3cNs3vkKdnkYlwffQ
    DW_GOOGLE_PUBLIC_KEY: AIzaSyAdmOWQGKH38VkGRiprHtSIVP3NhbDj69A
    DW_GOOGLE_CUSTOM_SEARCH_CX: 017987995273492241149:qjaqo2emn3w
    DW_KAFKA_BROKERS: 172.31.31.203:9092
    DW_USE_DISTRIBUTED: true
    DW_INCOMING_URLS: memex.incoming_urls
    DW_KAFKA_CRAWLER_BROKERS: k01.istresearch.com:9092,k02.istresearch.com:9092,k03.istresearch.com:9092
    DW_ZK_QUORUM: 172.31.31.203:2181
    DW_SEARCH_API: http://172.31.44.172:8787/search/
  volumes:
    - /home/ubuntu/trail-selections/trail-specific-search:/tss
  command: scala -classpath "build/libs/Search-Crawler-1.0-all.jar" com.soteradefense.datawake.trails.topology.search.SearchTopology

dwurlcontents:
  build: ../trail-specific-search
  working_dir: /trail-specific-search
  links:
    - mysql:mysql
    - kafka:kafka
    - zookeeper:zk
  environment:
    DW_DB_JDBC: jdbc:mysql://172.31.31.203:3336/memex_sotera
    DW_CRAWLER_OUT: crawler-out
    DW_USE_DISTRIBUTED: true
    DW_KAFKA_BROKERS: 172.31.31.203:9092
    DW_LOCAL_ZK_QUORUM: 172.31.31.203:2181
    DW_ZK_QUORUM: z01.istresearch.com:2181,z02.istresearch.com:2181,z03.istresearch.com:2181
    DW_DB_USER: root
    DW_DB_PASSWORD: root
    DW_CRAWLER_TOPIC: memex.crawled_trail-entities-search
  command: scala -classpath "build/libs/Search-Crawler-1.0-all.jar" com.soteradefense.datawake.trails.topology.save.UrlContentsTopology

datawake:
  build: ../server
  links:
    - mysql:mysql
    - kafka:kafka
  ports:
    - "80:80"
  environment:
    DW_DB: memex_sotera
    DW_DB_USER: root
    DW_DB_PASSWORD: root
    DW_DB_HOST: 172.31.31.203
    DW_DB_PORT: 3336
    DW_KAFKA_CONN_POOL: 172.31.31.203:9092
    DW_KAFKA_PUB_TOPIC: memex-datawake-visited
    DW_KAFKA_TRAIL_TOPIC: trail-search
    DW_GOOGLE_CLIENT_IDS: 587886725690-bsns7flvb68l48q95f9l1su82q0p4k00.apps.googleusercontent.com,587886725690-njd26v0l3krmar5vtc8e06oprtqvkdvd.apps.googleusercontent.com
    DW_MOCK_AUTH:  1
    DW_CONN_TYPE: mysql
    #DW_IMPALA_HOSTS:
    #DW_HBASE_HOST:
    #DW_EXTERNAL_LINK_NAMES:
    #DW_EXTERNAL_LINK_VALUES:
  volumes:
    - /home/ubuntu/trail-selections/server/datawake:/usr/local/share/tangelo/web/datawake
    - /home/ubuntu/trail-selections/server/domain:/usr/local/share/tangelo/web/domain
    - /home/ubuntu/trail-selections/server/forensic:/usr/local/share/tangelo/web/forensic
    - /home/ubuntu/trail-selections/memex-datawake-stream:/memex-datawake-stream
    - /home/ubuntu/trail-selections/server/js/:/usr/local/share/tangelo/web/js/datawake

dwstream:
  build: ../memex-datawake-stream
  links:
    - mysql:mysql
    - kafka:kafka
    - zookeeper:zk
  environment:
      DW_DB: memex_sotera
      DW_DB_USER: root
      DW_DB_PASSWORD: root
      DW_DB_HOST: 172.31.31.203
      DW_DB_PORT: 3336
  volumes:
    - /home/ubuntu/trail-selections/memex-datawake-stream:/memex-datawake-stream
    - /home/ubuntu/trail-selections/dev-env:/dev-env
